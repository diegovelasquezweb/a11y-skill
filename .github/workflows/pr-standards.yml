name: PR Standards

on:
  pull_request:
    types: [opened, edited, synchronize]

jobs:
  validate-title:
    name: Validate PR Title
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Code
        uses: actions/checkout@v4

      - name: Check PR Title (Conventional Commits)
        run: |
          TITLE="${{ github.event.pull_request.title }}"
          REGEX="^(feat|fix|chore|refactor|docs|style|test|perf|build|ci)(\([a-z0-9-]+\))?:\s.{5,}$"
          if [[ ! "$TITLE" =~ $REGEX ]]; then
            echo "❌ PR title does NOT follow standard naming conventions."
            echo "Expected format: <type>(<optional-scope>): <description>"
            echo "Example: 'feat: add accessibility audit engine'"
            exit 1
          fi
          echo "✅ PR title follows standards."

  verify-integrity:
    name: Verify Project Integrity
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Code
        uses: actions/checkout@v4

      - name: Setup pnpm
        uses: pnpm/action-setup@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 20
          cache: 'pnpm'

      - name: Install Dependencies
        run: pnpm install --frozen-lockfile

      - name: Security Audit
        run: pnpm audit
